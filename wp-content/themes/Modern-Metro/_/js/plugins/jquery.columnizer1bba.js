(function(a){a.fn.columnize=function(b){var c={width:400,columns:false,buildOnce:false,overflow:false,doneFunc:function(){},target:false,ignoreImageLoading:true,columnFloat:"left",lastNeverTallest:false,accuracy:false,manualBreaks:false,cssClassPrefix:""};var b=a.extend(c,b);if(typeof b.width=="string"){b.width=parseInt(b.width);if(isNaN(b.width)){b.width=c.width}}return this.each(function(){function m(a,b){var c=b?".":"";if(j.length){return c+j+"-"+a}return c+a}function n(c,d,e,f){while((i||e.height()<f)&&d[0].childNodes.length){var g=d[0].childNodes[0];if(a(g).find(m("columnbreak",true)).length){return}if(a(g).hasClass(m("columnbreak"))){return}c.append(g)}if(c[0].childNodes.length==0)return;var h=c[0].childNodes;var j=h[h.length-1];c[0].removeChild(j);var k=a(j);if(k[0].nodeType==3){var l=k[0].nodeValue;var n=b.width/18;if(b.accuracy)n=b.accuracy;var o;var p=null;while(e.height()<f&&l.length){var q=l.indexOf(" ",n);if(q!=-1){o=l.substring(0,l.indexOf(" ",n))}else{o=l}p=document.createTextNode(o);c.append(p);if(l.length>n&&q!=-1){l=l.substring(q)}else{l=""}}if(e.height()>=f&&p!=null){c[0].removeChild(p);l=p.nodeValue+l}if(l.length){k[0].nodeValue=l}else{return false}}if(d.contents().length){d.prepend(k)}else{d.append(k)}return k[0].nodeType==3}function o(a,b,c,d){if(a.contents(":last").find(m("columnbreak",true)).length){return}if(a.contents(":last").hasClass(m("columnbreak"))){return}if(b.contents().length){var e=b.contents(":first");if(e.get(0).nodeType!=1)return;var f=e.clone(true);if(e.hasClass(m("columnbreak"))){a.append(f);e.remove()}else if(i){a.append(f);e.remove()}else if(f.get(0).nodeType==1&&!f.hasClass(m("dontend"))){a.append(f);if(f.is("img")&&c.height()<d+20){e.remove()}else if(!e.hasClass(m("dontsplit"))&&c.height()<d+20){e.remove()}else if(f.is("img")||e.hasClass(m("dontsplit"))){f.remove()}else{f.empty();if(!n(f,e,c,d)){e.addClass(m("split"));if(e.children().length){o(f,e,c,d)}}else{e.addClass(m("split"))}if(f.get(0).childNodes.length==0){f.remove()}}}}}function p(){if(d.data("columnized")&&d.children().length==1){return}d.data("columnized",true);d.data("columnizing",true);d.empty();d.append(a("<div class='"+m("first")+" "+m("last")+" "+m("column")+" "+"' style='width:100%; float: "+b.columnFloat+";'></div>"));$col=d.children().eq(d.children().length-1);$destroyable=f.clone(true);if(b.overflow){targetHeight=b.overflow.height;n($col,$destroyable,$col,targetHeight);if(!$destroyable.contents().find(":first-child").hasClass(m("dontend"))){o($col,$destroyable,$col,targetHeight)}while($col.contents(":last").length&&q($col.contents(":last").get(0))){var c=$col.contents(":last");c.remove();$destroyable.prepend(c)}var e="";var g=document.createElement("DIV");while($destroyable[0].childNodes.length>0){var h=$destroyable[0].childNodes[0];if(h.attributes){for(var i=0;i<h.attributes.length;i++){if(h.attributes[i].nodeName.indexOf("jQuery")==0){h.removeAttribute(h.attributes[i].nodeName)}}}g.innerHTML="";g.appendChild($destroyable[0].childNodes[0]);e+=g.innerHTML}var j=a(b.overflow.id)[0];j.innerHTML=e}else{$col.append($destroyable)}d.data("columnizing",false);if(b.overflow&&b.overflow.doneFunc){b.overflow.doneFunc()}}function q(b){if(b.nodeType==3){if(/^\s+$/.test(b.nodeValue)){if(!b.previousSibling)return false;return q(b.previousSibling)}return false}if(b.nodeType!=1)return false;if(a(b).hasClass(m("dontend")))return true;if(b.childNodes.length==0)return false;return q(b.childNodes[b.childNodes.length-1])}function r(){k=0;if(g==d.width())return;g=d.width();var c=Math.round(d.width()/b.width);var h=b.width;var j=b.height;if(b.columns)c=b.columns;if(i){c=f.find(m("columnbreak",true)).length+1;h=false}if(c<=1){return p()}if(d.data("columnizing"))return;d.data("columnized",true);d.data("columnizing",true);d.empty();d.append(a("<div style='width:"+Math.floor(100/c)+"%; float: "+b.columnFloat+";'></div>"));z=d.children(":last");z.append(f.clone());e=z.height();d.empty();var l=e/c;var r=true;var s=3;var t=false;if(b.overflow){s=1;l=b.overflow.height}else if(j&&h){s=1;l=j;t=true}for(var u=0;u<s&&s<20;u++){d.empty();var v;try{v=f.clone(true)}catch(w){v=f.clone()}v.css("visibility","hidden");for(var x=0;x<c;x++){var y=x==0?m("first"):"";y+=" "+m("column");var y=x==c-1?m("last")+" "+y:y;d.append(a("<div class='"+y+"' style='width:"+Math.floor(100/c)+"%; float: "+b.columnFloat+";'></div>"))}var x=0;while(x<c-(b.overflow?0:1)||t&&v.contents().length){if(d.children().length<=x){d.append(a("<div class='"+y+"' style='width:"+Math.floor(100/c)+"%; float: "+b.columnFloat+";'></div>"))}var z=d.children().eq(x);n(z,v,z,l);o(z,v,z,l);while(z.contents(":last").length&&q(z.contents(":last").get(0))){var A=z.contents(":last");A.remove();v.prepend(A)}x++;if(z.contents().length==0&&v.contents().length){z.append(v.contents(":first"))}else if(x==c-(b.overflow?0:1)&&!b.overflow){if(v.find(m("columnbreak",true)).length){c++}}}if(b.overflow&&!t){var B=false;var C=document.all&&navigator.appVersion.indexOf("MSIE 7.")!=-1;if(B||C){var D="";var E=document.createElement("DIV");while(v[0].childNodes.length>0){var F=v[0].childNodes[0];for(var x=0;x<F.attributes.length;x++){if(F.attributes[x].nodeName.indexOf("jQuery")==0){F.removeAttribute(F.attributes[x].nodeName)}}E.innerHTML="";E.appendChild(v[0].childNodes[0]);D+=E.innerHTML}var G=a(b.overflow.id)[0];G.innerHTML=D}else{a(b.overflow.id).empty().append(v.contents().clone(true))}}else if(!t){z=d.children().eq(d.children().length-1);while(v.contents().length)z.append(v.contents(":first"));var H=z.height();var I=H-l;var J=0;var K=1e7;var L=0;var M=false;var N=0;d.children().each(function(a){return function(b){var c=a.children().eq(b);var d=c.children(":last").find(m("columnbreak",true)).length;if(!d){var e=c.height();M=false;J+=e;if(e>L){L=e;M=true}if(e<K)K=e;N++}}}(d));var O=J/N;if(J==0){u=s}else if(b.lastNeverTallest&&M){k+=30;l=l+30;if(u==s-1)s++}else if(L-K>30){l=O+30}else if(Math.abs(O-l)>20){l=O}else{u=s}}else{d.children().each(function(a){z=d.children().eq(a);z.width(h+"px");if(a==0){z.addClass(m("first"))}else if(a==d.children().length-1){z.addClass(m("last"))}else{z.removeClass(m("first"));z.removeClass(m("last"))}});d.width(d.children().length*h+"px")}d.append(a("<br style='clear:both;'>"))}d.find(m("column",true)).find(":first"+m("removeiffirst",true)).remove();d.find(m("column",true)).find(":last"+m("removeiflast",true)).remove();d.data("columnizing",false);if(b.overflow){b.overflow.doneFunc()}b.doneFunc()}var d=b.target?a(b.target):a(this);var e=a(this).height();var f=a("<div></div>");var g=0;var h=false;var i=b.manualBreaks;var j=c.cssClassPrefix;if(typeof b.cssClassPrefix=="string"){j=b.cssClassPrefix}var k=0;f.append(a(this).contents().clone(true));if(!b.ignoreImageLoading&&!b.target){if(!d.data("imageLoaded")){d.data("imageLoaded",true);if(a(this).find("img").length>0){var l=function(a,c){return function(){if(!a.data("firstImageLoaded")){a.data("firstImageLoaded","true");a.empty().append(c.children().clone(true));a.columnize(b)}}}(a(this),f);a(this).find("img").one("load",l);a(this).find("img").one("abort",l);return}}}d.empty();r();if(!b.buildOnce){a(window).resize(function(){if(!b.buildOnce&&a.browser.msie){if(d.data("timeout")){clearTimeout(d.data("timeout"))}d.data("timeout",setTimeout(r,200))}else if(!b.buildOnce){r()}else{}})}})}})(jQuery)